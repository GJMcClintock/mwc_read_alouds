<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Math with Confidence - Read Alouds</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 2rem;
      background-color: #f4f6fa;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: #2c3e50;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 0.5rem;
    }
    select {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fefefe;
    }
    .video-section {
      margin-top: 2rem;
      display: none;
      border-top: 1px solid #ddd;
      padding-top: 1.5rem;
    }
    h2 {
      color: #34495e;
      margin-bottom: 1rem;
    }
    iframe {
      width: 100%;
      height: 450px;
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <div class="container">
      <h1>Math with Confidence Read‑Alouds</h1>
      <p>Not all books are available on YouTube, so you may see some similar alternatives.</p>
      <!-- Grade picker -->
      <label for="grade-select">Select grade:</label>
      <select id="grade-select">
        <option value="">-- Select a grade --</option>
        <!-- Manually add grade options below -->
        <option value="K">K</option>
        <option value="1st">1st</option>
      </select>
    <label for="video-select">Choose a week:</label>
    <select id="video-select">
      <option value="">-- Select a video --</option>
    </select>

    <div id="video-display" class="video-section">
      <h2 id="video-title"></h2>
      <iframe id="video-frame" src="" allowfullscreen></iframe>
    </div>
  </div>

  <!-- Attribution footer -->
  <p style="text-align:center; margin-top:1rem;">
    This site is made as a support resource for Kate Snow's fantastic curriculum
    <a href="https://kateshomeschoolmath.com/math-with-confidence-homeschool-math-curriculum/">Math with Confidence</a>,
    published by
    <a href="https://welltrainedmind.com/">Well-Trained Mind Press</a>.
    <br><br>
    You can find support for the curriculum in the <a href="https://www.facebook.com/share/g/19JAp9wRt6/">Math with Confidence Community</a> Facebook Group.
  </p>

  <script>
    const select = document.getElementById("video-select");
    const display = document.getElementById("video-display");
    const title = document.getElementById("video-title");
    const frame = document.getElementById("video-frame");

    // --- Grade‑driven video loading ---
    const gradeSelect = document.getElementById("grade-select");
    let videoData = [];

    // Simple CSV line parser that respects quoted fields and escaped quotes ("")
    function parseCSVLine(line) {
      const out = [];
      let cur = '';
      let inQuotes = false;
      for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch === '"') {
          if (inQuotes && line[i + 1] === '"') { // escaped quote
            cur += '"';
            i++; // skip next quote
          } else {
            inQuotes = !inQuotes;
          }
        } else if (ch === ',' && !inQuotes) {
          out.push(cur);
          cur = '';
        } else {
          cur += ch;
        }
      }
      out.push(cur);
      return out;
    }

    // Populate the week dropdown whenever videoData changes
    function updateVideoSelect() {
      select.innerHTML = '<option value="">-- Select a video --</option>';
      videoData.forEach(v => {
        const opt = document.createElement("option");
        opt.value = v.url;
        opt.textContent = `Week ${v.week} - ${v.title}`;
        opt.dataset.title = v.title;
        select.appendChild(opt);
      });
    }


    // When a grade is selected, load its CSV and refresh the week list
    gradeSelect.addEventListener('change', () => {
      if (!gradeSelect.value) {
        select.innerHTML = '<option value="">-- Select a video --</option>';
        display.style.display = 'none';
        return;
      }
      fetch(`grades/${gradeSelect.value}.csv`)
        .then(r => {
          if (!r.ok) {
            throw new Error(`Could not load grades/${gradeSelect.value}.csv`);
          }
          return r.text();
        })
        .then(txt => {
          const lines = txt.trim().split(/[\r\n]+/);
          // Assume CSV header: week,title,url
          videoData = lines.slice(1).map(line => {
            const [weekStr, rawTitle, url] = parseCSVLine(line);
            const week = +weekStr;
            const title = rawTitle.replace(/^"|"$/g, ''); // remove surrounding quotes
            return { week, title, url };
          });
          updateVideoSelect();
        })
        .catch(err => {
          console.error(err);
          alert('Unable to load the video list for that grade. Make sure the CSV file exists and that you are serving this site over http:// or https:// (opening index.html directly will block fetch).');
        });
    });

    select.addEventListener("change", () => {
      const selected = select.options[select.selectedIndex];
      if (!selected.value) {
        display.style.display = "none";
        return;
      }
      title.textContent = selected.dataset.title;
      const embedUrl = selected.value.replace("watch?v=", "embed/");
      frame.src = embedUrl;
      display.style.display = "block";
    });
  </script>
</body>
</html>
